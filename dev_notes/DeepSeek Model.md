# DeepSeek Model

æœ¬æ–‡ç›®æ ‡æ˜¯ç†æ¸… DeepSeek æ¨¡å‹ç»“æ„ï¼Œå¹¶ç†è§£å…¶ä¸­çš„åŠ¨æœºï¼šä¸ºä»€ä¹ˆä» llama-like transformer å‘å±•åˆ°äº†ç°åœ¨çš„ deepseek-like transformerã€‚ä» [DeepSeek V3 Technical Report](https://arxiv.org/pdf/2412.19437v1) ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡å‹ç»“æ„ç›®å‰æ˜¯æ·±åº¦å­¦ä¹ ä¸­æœ€ç®€å•ï¼ˆä½†éœ€è¦å¤§é‡çš„å®éªŒè¯•é”™ï¼‰çš„ä¸€ä¸ªç¯èŠ‚ï¼ŒæŠ¥å‘Šä¸­ä»…ç”¨äº†5é¡µç¯‡å¹…ã€‚å‰©ä½™å¤§é‡çš„ç¯‡å¹…é›†ä¸­åœ¨ Infrastructure & Training algorithm

## MoE

éšç€å¯¹æ·±åº¦å­¦ä¹ çš„ç†è§£è¶Šæ¥è¶Šå¤šï¼Œä¼¼ä¹æœ‰è¿™æ ·ä¸€ä¸ªäº‹å®é€æ¸æµ®ç°å‡ºæ¥ï¼šåœ¨ transformer å½“ä¸­çš„ MLP å æ®äº†æ¨¡å‹çš„å¤§éƒ¨åˆ†å‚æ•°ï¼Œå…¶åŠŸèƒ½æ˜¯ä½œä¸ºæ¨¡å‹çš„æ•°æ®åº“æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚3b1b åšäº†ä¸€ä¸ªç§‘æ™®è§†é¢‘æ¥è¿›è¡Œè®²è§£ [How might LLMs store facts](https://www.bilibili.com/video/BV1aTxMehEjK) å¯¹åº”çš„ [blog](https://www.3blue1brown.com/lessons/mlp)

åŸºäºæ­¤äº‹å®ï¼Œæ¯ä¸€æ¬¡åœ¨ç»è¿‡ MLP æ—¶éƒ½ä¼šå¯¹æ‰€æœ‰çš„â€œæ•°æ®åº“â€è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´èµ„æºçš„æµªè´¹ï¼Œå› ä¸ºæœ‰çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦æ‰€æœ‰çš„ä¿¡æ¯ã€‚æ­¤æ—¶å¼•å…¥ Miture of Experts (MoE) å°±ä¼šæ˜¾å¾—æ›´åŠ è‡ªç„¶ï¼šæˆ‘ä»¬å¯ä»¥æŠŠ MLP æ‹†åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†è¢«ç§°ä¸ºä¸€ä¸ªä¸“å®¶ã€‚æ¯æ¬¡ç»è¿‡ MLP æ—¶åªéœ€è¦åŠ è½½å¯¹åº”çš„ä¸“å®¶çŸ¥è¯†ï¼Œå³å¯è·å¾—å¥½çš„æŸ¥è¯¢ç»“æœ

åŸºäºä»¥ä¸Šç†è§£ MoE æœ€å¤§å¥½å¤„æœ‰ä¸¤ä¸ªï¼š

1. æ˜¾è‘—é™ä½å•ä¸ª token çš„è®¡ç®—æˆæœ¬ã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œåœ¨è®¡ç®—æˆæœ¬ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹çš„å®¹é‡æ˜¾è‘—å¢åŠ ï¼Œèƒ½å¤Ÿå­˜å‚¨æ›´å¤šçš„çŸ¥è¯†ã€‚ä»è®¡ç®—æ•ˆç‡å’Œæ¨¡å‹èƒ½åŠ›çš„ä¸¤ä¸ªè§’åº¦æ¥è¯´ï¼Œéƒ½æœ‰å¾ˆå¥½çš„å¸®åŠ©
2. æ›´å¼ºçš„å¤šæ¨¡æ€èƒ½åŠ›ã€‚è¿™ä¸€ç‚¹æ˜¯ç›´æ¥è¯¢é—® DeepSeek è·å¾—çš„ğŸ¤”ï¼Œå…¶è§£é‡Šä¸ºä¸åŒçš„æ¨¡æ€å¯ä»¥é€‰æ‹©å¯¹åº”çš„ä¸“å®¶ç»„åˆï¼Œå®ç°åˆ†æ²»å­¦ä¹ 

## MLA

### RoPE

- ä¸€ä¸ªè®¡ç®—æœ€å¤§ sequence length çš„ç®€å•æ–¹æ³•
  $$
  2\pi Â· (\text{rope theta})
  $$
  åŒæ—¶é€šå¸¸å–è¯¥å€¼çš„ä¸€åŠï¼Œå› ä¸ºæ­£å¼¦ä½™å¼¦çš„å¯¹ç§°æ€§æ‰€å¯¼è‡´

  > From DeepSeek
  >
  > ä½ç½® $\theta$ å’Œ $2\pi - \theta$ å‘ˆç°é•œåƒå¯¹ç§°ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸¤ä¸ªä½ç½®çš„è¯­ä¹‰å¯èƒ½å®Œå…¨ä¸åŒï¼Œç”¨é•œåƒçš„ä½ç½®æ¥è¡¨è¾¾å¹¶ä¸åˆé€‚





why shared k & v

query means different patterns, k & v means facts, normally the facts are the same, but the pattern can be various

positional embedding chages from rotation to adding bias, this would work if the added bias is good enough

## TODO

1. è´Ÿè½½å‡è¡¡ä¼˜åŒ–
2. ä¸“å®¶å¹¶è¡Œï¼ˆExpert Parallelï¼‰ & Grouped Gemm
3. MoBA & NSA: MoE in the Attention