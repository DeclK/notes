# AW Experiment

## 实验结果 test split

1. CenterPoint Baseline

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |64.62       |73.10       |43.15       |12.80       |
   |Bus         |58.88       |66.18       |59.63       |13.64       |
   |Pedestrian  |52.69       |55.93       |42.73       |5.24        |
   |Cyclist     |48.74       |50.53       |44.21       |28.64       |
   |mAP         |56.23       |61.43       |47.43       |15.08       |
   ```

2. IoU rectification $\lambda=0.5$

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |66.21       |74.85       |45.54       |14.94       |
   |Bus         |61.01       |68.67       |60.04       |14.57       |
   |Pedestrian  |56.85       |60.58       |44.99       |7.08        |
   |Cyclist     |53.40       |56.05       |47.09       |31.01       |
   |mAP         |59.37       |65.04       |49.41       |16.90       |
   ```

   经过搜索获得最好的表现

   ```txt
   RECTIFIER: [0.7, 0.67, 0.53, 0.65]
   
   # test split
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |66.55       |75.36       |45.35       |15.27       |
   |Bus         |61.24       |68.03       |59.54       |14.71       |
   |Pedestrian  |56.86       |60.48       |45.15       |7.33        |
   |Cyclist     |53.84       |56.77       |46.49       |30.36       |
   |mAP         |59.62       |65.16       |49.13       |16.92       |
   
   # validation split
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |65.59       |72.42       |44.75       |25.54       |
   |Bus         |58.57       |69.33       |47.44       |17.86       |
   |Pedestrian  |65.45       |70.23       |26.58       |1.39        |
   |Cyclist     |47.82       |50.88       |36.73       |16.70       |
   |mAP         |59.36       |65.71       |38.87       |15.37       |
   ```

3. IoU regression 几乎没有提升

4. CGAM 加入后反而掉点，特别是 cyclist

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |64.22       |72.49       |43.15       |12.51       |
   |Bus         |59.98       |67.19       |59.22       |12.97       |
   |Pedestrian  |52.69       |56.01       |41.33       |8.72        |
   |Cyclist     |44.71       |46.49       |41.79       |29.70       |
   |mAP         |55.40       |60.55       |46.37       |15.97       |
   ```

6. iou + cgam v2 centerpoint single head，行人掉点，其他均有提升，如果调整一下 rectifier 应该能够达到 59.95 

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |67.14       |75.77       |45.93       |15.28       |
   |Bus         |62.72       |69.85       |61.38       |15.99       |
   |Pedestrian  |53.90       |56.73       |45.59       |11.18       |
   |Cyclist     |55.42       |58.56       |46.30       |32.50       |
   |mAP         |59.79       |65.23       |49.80       |18.74       |
   ```

7. iou debug version, modify bev backbone and post processing

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |66.56       |75.95       |42.72       |15.30       |
   |Bus         |60.62       |68.01       |58.72       |17.58       |
   |Pedestrian  |55.72       |58.33       |48.08       |12.27       |
   |Cyclist     |53.80       |56.75       |45.42       |29.57       |
   |mAP         |59.18       |64.76       |48.73       |18.68       |
   ```

9. iou multi-head lr 0.001, epoch 160

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |67.06       |76.84       |45.71       |13.62       |
   |Bus         |61.44       |68.91       |59.39       |13.52       |
   |Pedestrian  |57.47       |61.09       |47.24       |12.96       |
   |Cyclist     |53.54       |56.91       |43.51       |36.35       |
   |mAP         |59.88       |65.94       |48.96       |19.11       |
   ```

## Val & Test

1. best val, iou + cgam + sc

   ```txt
   # val
   |Car         |65.17       |73.62       |42.29       |27.60       |
   |Bus         |55.84       |66.64       |45.52       |17.47       |
   |Cyclist     |51.39       |53.91       |37.71       |26.81       |
   |Pedestrian  |65.56       |71.15       |24.35       |0.30        |
   |mAP         |59.49
   ```

2. iou + cgam，CGAM might better also use multi-head

   ```txt
   # val
   |Car         |66.75       |73.37       |47.10       |28.88       |
   |Bus         |56.47       |66.75       |46.53       |18.76       |
   |Cyclist     |48.70       |51.55       |36.37       |20.50       |
   |Pedestrian  |66.88       |71.48       |29.10       |0.75        |
   |mAP         |59.70
   ```

3. iou，所有都是在矫正过后的数据集上进行测试

   ```txt
   # val
   |Car         |65.65       |72.57       |45.10       |26.56       |
   |Bus         |57.36       |67.63       |47.09       |17.22       |
   |Cyclist     |49.04       |51.62       |38.70       |21.62       |
   |Pedestrian  |65.59       |72.50       |24.36       |1.63        |
   |mAP         |59.41
   ```

4. iou + sc

   ```txt
   |Car         |66.27       |73.14       |44.49       |31.12       |
   |Bus         |55.98       |67.37       |45.43       |16.24       |
   |Cyclist     |50.25       |52.83       |33.10       |28.08       |
   |Pedestrian  |65.20       |69.61       |30.09       |0.09        |
   |mAP         |59.43
   ```

结论：对于混合类型的数据集难以提点...总是只能照顾到某一些类别的提升，有的类别反而会下降

## 16_4

1. iou

   ```txt
   |Car         |66.74       |74.66       |29.38       |15.46       |
   |Bus         |68.27       |76.30       |58.87       |24.43       |
   |Cyclist     |60.51       |64.88       |37.68       |1.89        |
   |Pedestrian  |54.10       |60.20       |39.56       |6.53        |
   |mAP         |62.41
   ```

2. iou + cgam single head weight 0.25，看来 cgam single head 确实没什么提升效果...尝试一下 multi-head

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |65.04       |72.53       |31.17       |15.75       |
   |Bus         |68.73       |77.45       |61.55       |27.03       |
   |Cyclist     |60.70       |64.98       |39.71       |4.48        |
   |Pedestrian  |54.25       |59.44       |41.50       |10.51       |
   |mAP         |62.18       |68.60       |43.48       |14.44       |
   ```

3. iou + cgam single head weight 1 & 2

4. iou + cgam single head weight 1 & 1

## Test2

1. iou multi-head lr 0.001, epoch 160

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |64.76       |77.64       |46.75       |25.65       |
   |Bus         |55.08       |60.51       |53.52       |38.06       |
   |Pedestrian  |32.98       |36.96       |27.72       |8.17        |
   |Cyclist     |56.52       |67.92       |35.66       |15.17       |
   |mAP         |52.33       |60.76       |40.91       |21.76       |
   ```

2. iou multi-head

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |65.02       |78.74       |47.69       |25.55       |
   |Bus         |53.65       |61.92       |48.28       |42.69       |
   |Pedestrian  |37.06       |41.81       |29.62       |15.05       |
   |Cyclist     |54.22       |64.10       |36.03       |14.27       |
   |mAP         |52.49       |61.64       |40.40       |24.39       |
   
   # calibrate
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |64.73       |77.49       |47.26       |25.46       |
   |Bus         |54.89       |61.62       |49.72       |48.32       |
   |Cyclist     |54.80       |65.76       |35.18       |11.28       |
   |Pedestrian  |36.95       |42.15       |29.57       |10.08       |
   |mAP         |52.85       |61.76       |40.43       |23.78       |
   ```

3. iou aux

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |66.80       |77.88       |51.46       |34.24       |
   |Bus         |53.98       |61.87       |50.30       |40.03       |
   |Pedestrian  |33.82       |37.17       |30.39       |10.96       |
   |Cyclist     |55.55       |65.48       |38.72       |15.98       |
   |mAP         |52.54       |60.60       |42.72       |25.30       |
   ```

4. iou single head

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |67.27       |79.95       |50.36       |33.42       |
   |Bus         |54.02       |63.93       |47.85       |41.81       |
   |Pedestrian  |32.19       |34.48       |31.03       |17.44       |
   |Cyclist     |54.80       |65.07       |37.45       |15.52       |
   |mAP         |52.07       |60.86       |41.67       |27.05       |
   ```

## Half Dataset Experiment

1. Half centerpoint baseline

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |59.89       |68.45       |40.16       |13.17       |
   |Bus         |54.84       |62.28       |51.04       |14.38       |
   |Pedestrian  |41.72       |42.26       |42.21       |7.69        |
   |Cyclist     |45.69       |46.47       |45.39       |28.74       |
   |mAP         |50.53       |54.87       |44.70       |16.00       |
   ```
   
2. CGAM Repv2 centerpoint single head

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |62.31       |71.05       |40.91       |14.95       |
   |Bus         |56.33       |64.31       |51.20       |18.24       |
   |Pedestrian  |45.25       |46.67       |43.24       |11.70       |
   |Cyclist     |45.51       |46.51       |45.82       |34.20       |
   |mAP         |52.35       |57.13       |45.29       |19.77       |
   ```

3. SC-Conv class agnostic

   ```txt
   |AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
   |Car         |62.65       |71.44       |42.22       |14.48       |
   |Bus         |58.16       |65.80       |52.86       |15.08       |
   |Pedestrian  |42.51       |43.53       |41.11       |9.13        |
   |Cyclist     |42.61       |44.27       |38.95       |30.43       |
   |mAP         |51.48       |56.26       |43.79       |17.28       |
   ```

## 历史模型

```txt
|AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
|Car         |67.49       |76.69       |52.13       |2.86        |
|Bus         |68.75       |78.98       |74.07       |7.12        |
|Cyclist     |70.33       |73.62       |43.44       |0.00        |
|Pedestrian  |61.47       |63.21       |47.91       |58.80       |
|mAP         |67.01       |73.13       |54.39       |17.19       |
```

历史模型新测试集上的表现

```txt
|AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
|Car         |58.65       |76.20       |32.42       |12.95       |
|Bus         |38.53       |54.29       |30.59       |8.28        |
|Cyclist     |43.59       |56.29       |20.78       |5.26        |
|Pedestrian  |20.77       |20.78       |24.92       |4.31        |
|mAP         |40.38       |51.89       |27.18       |7.70        |

# old val and test 
|AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
|Car         |69.21       |79.15       |45.91       |16.81       |
|Bus         |72.35       |83.09       |67.79       |18.73       |
|Cyclist     |58.54       |65.35       |36.53       |10.78       |
|Pedestrian  |61.43       |66.53       |45.76       |26.90       |
|mAP         |65.38       |73.53       |49.00       |18.31       |

|AP@50       |overall     |0-30m       |30-50m      |50m-inf     |
|Car         |66.62       |75.22       |48.34       |21.86       |
|Bus         |68.42       |79.56       |67.41       |19.69       |
|Cyclist     |53.16       |55.60       |41.07       |9.01        |
|Pedestrian  |63.00       |64.81       |57.82       |3.04        |
|mAP         |62.80       |68.80       |53.66       |13.40       |
```

当前模型在新测试集上的表现，比历史模型好得多，说明之前的模型过拟合了





